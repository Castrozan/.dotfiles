# Autostart applications

exec-once = gnome-keyring-daemon --start --components=secrets
exec-once = swaybg -i ~/.config/hypr-theme/current/background -m fill || swaybg --color '#000000'
exec-once = wl-paste --type text --watch cliphist store
exec-once = wl-paste --type image --watch cliphist store
exec-once = /run/current-system/sw/libexec/polkit-gnome-authentication-agent-1 || /usr/lib/polkit-gnome/polkit-gnome-authentication-agent-1

exec-once = systemctl --user import-environment WAYLAND_DISPLAY XDG_CURRENT_DESKTOP HYPRLAND_INSTANCE_SIGNATURE DISPLAY XAUTHORITY DBUS_SESSION_BUS_ADDRESS
exec-once = dbus-update-activation-environment --systemd WAYLAND_DISPLAY XDG_CURRENT_DESKTOP DISPLAY XAUTHORITY DBUS_SESSION_BUS_ADDRESS

# Start graphical services after environment is imported
# Services have ConditionEnvironment=WAYLAND_DISPLAY so import must complete first
exec-once = sleep 2 && systemctl --user start waybar.service mako.service hyprshell.service

# Restart portals: backends first, then main portal (must discover backends)
exec-once = sleep 3 && systemctl --user restart xdg-desktop-portal-hyprland xdg-desktop-portal-gtk && sleep 1 && systemctl --user restart xdg-desktop-portal

# Cursor and theme
exec-once = hyprctl setcursor Bibata-Modern-Classic 24
exec-once = hypr-theme-set "$(cat ~/.config/hypr-theme/current/theme.name 2>/dev/null || echo catppuccin)"

# Daemons
exec-once = hypr-maximize-focus-daemon
exec-once = hypr-monitor-hotplug-daemon
exec-once = ~/.config/waybar/scripts/workspace-coordinator.sh

# Launch terminal on workspace 11 (screensaver workspace)
exec-once = [workspace 11 silent] wezterm

# Switch to workspace 11 only once per boot (not every Hyprland restart/reload).
exec-once = sh -lc 'stamp="${XDG_RUNTIME_DIR:-/tmp}/hypr-workspace11-once"; if [ ! -e "$stamp" ]; then : >"$stamp"; sleep 2; hyprctl dispatch workspace 11; fi'
