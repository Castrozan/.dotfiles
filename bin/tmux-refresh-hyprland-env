#!/usr/bin/env bash
# Refresh Hyprland env vars in tmux after resurrect or Hyprland restart

HYPR_DIR="/run/user/$(id -u)/hypr"

if [[ ! -d "$HYPR_DIR" ]]; then
  exit 0
fi

# Get current Hyprland instance (most recent)
NEW_SIG=$(ls -1t "$HYPR_DIR" 2>/dev/null | head -1)

if [[ -z "$NEW_SIG" ]]; then
  exit 0
fi

# Update tmux global environment
tmux setenv HYPRLAND_INSTANCE_SIGNATURE "$NEW_SIG"

# Send export to all panes (best effort, won't work for non-shell processes)
for pane in $(tmux list-panes -a -F '#{pane_id}'); do
  tmux send-keys -t "$pane" "export HYPRLAND_INSTANCE_SIGNATURE='$NEW_SIG'" Enter 2>/dev/null || true
done
