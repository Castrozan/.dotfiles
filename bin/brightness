#!/usr/bin/env bash

set -Eeuo pipefail

readonly BRIGHTNESS_STEP_NORMAL=10
readonly BRIGHTNESS_STEP_PRECISE=1

main() {
	case "${1:-}" in
	--inc) _change_brightness "+${BRIGHTNESS_STEP_NORMAL}%" ;;
	--dec) _change_brightness "${BRIGHTNESS_STEP_NORMAL}%-" ;;
	--inc-precise) _change_brightness "+${BRIGHTNESS_STEP_PRECISE}%" ;;
	--dec-precise) _change_brightness "${BRIGHTNESS_STEP_PRECISE}%-" ;;
	--get) _get_brightness_percentage ;;
	*) _get_brightness_percentage ;;
	esac
}

_get_brightness_percentage() {
	brightnessctl -m | cut -d, -f4 | tr -d '%'
}

_change_brightness() {
	local adjustment=$1
	brightnessctl set "$adjustment" >/dev/null

	local current_brightness
	current_brightness=$(_get_brightness_percentage)
	quickshell-osd-send brightness "$current_brightness"
}

main "$@"
