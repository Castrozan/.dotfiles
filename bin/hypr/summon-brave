#!/usr/bin/env bash
# Summon Brave browser to current workspace

CLASS="brave-browser"

current_ws=$(hyprctl activeworkspace -j | jq -r '.id')

brave_window=$(hyprctl clients -j | jq -r --arg class "$CLASS" '
  .[] | select(.class == $class) | {address, workspace: .workspace.id, fullscreen}
' | jq -s 'first // empty')

if [[ -z "$brave_window" || "$brave_window" == "null" ]]; then
    exec brave
fi

address=$(echo "$brave_window" | jq -r '.address')
source_ws=$(echo "$brave_window" | jq -r '.workspace')
was_fullscreen=$(echo "$brave_window" | jq -r '.fullscreen')

if [[ "$source_ws" == "$current_ws" ]]; then
    hyprctl dispatch focuswindow "address:$address"
    exit 0
fi

hyprctl dispatch movetoworkspace "$current_ws,address:$address"

# Restore fullscreen only if it was lost during move (fullscreen 1 is a toggle)
if [[ "$was_fullscreen" == "1" ]]; then
    sleep 0.05
    current_fullscreen=$(hyprctl clients -j | jq -r --arg addr "$address" '.[] | select(.address == $addr) | .fullscreen')
    if [[ "$current_fullscreen" != "1" ]]; then
        hyprctl dispatch fullscreen 1
    fi
fi
