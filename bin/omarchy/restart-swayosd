#!/usr/bin/env bash
# Reload swayosd for theme changes
# SwayOSD reads CSS at startup, needs restart for theme changes
# But we rate-limit to avoid systemd start-limit-hit

LAST_RESTART_FILE="/tmp/swayosd-last-restart"

if systemctl --user is-active --quiet swayosd; then
  # Rate limit: only restart if more than 5 seconds since last restart
  now=$(date +%s)
  last=$(cat "$LAST_RESTART_FILE" 2>/dev/null || echo 0)
  if (( now - last > 5 )); then
    echo "$now" > "$LAST_RESTART_FILE"
    systemctl --user restart swayosd 2>/dev/null || true
  fi
else
  systemctl --user start swayosd 2>/dev/null || true
fi
